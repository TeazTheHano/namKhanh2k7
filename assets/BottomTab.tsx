// system imports
import React, { Component, useEffect, useRef } from 'react';
import { createBottomTabNavigator, BottomTabBar } from '@react-navigation/bottom-tabs';
import { useNavigation } from '@react-navigation/native';
import { Animated, Platform, Text, TouchableOpacity, View } from 'react-native';

// style import
import styles, { vw, vh, vmax, vmin } from './stylesheet';

// screen import
import Home from '../screens/Home';
import User from '../screens/User';
import Shop from '../screens/Shop';
import Community from '../screens/Community';

import * as SVG from './svgXml';
import * as STORAGEFNC from '../data/storageFunc'
import { SvgXml } from 'react-native-svg';
import * as CLASS from './Class';
import * as CTEXT from './CustomText';
import clrStyle, { NGHIASTYLE } from './componentStyleSheet';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import * as CUSTOMCACHE from '../data/store';
import { UserFormat } from '../data/interfaceFormat';

const VH_VW = vw(100) > vh(100) ? true : false
const BOTTOM_TAB_ICON_SIZE = VH_VW ? vh(6) : vw(6)
const BOTTOM_TAB_ICON_PADDING = VH_VW ? vh(2) : vw(2)
const BOTTOM_TAB_ICON_HEIGHT = VH_VW ? vh(14) : vw(14)
const BOTTOM_TAB_HEIGHT = VH_VW ? vh(16) : vw(16)
const COLORFOCUS = NGHIASTYLE.NghiaSuccess500
const COLORNOTFOCUS = clrStyle.grey1
const LABELTEXTCLASS = CTEXT.Nunito14Reg

// icon generator
const iconData: { page: any, icon: string, iconActive: string, title: string }[] = [
    {
        page: Home,
        iconActive: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.04 6.82018L14.28 2.79018C12.71 1.69018 10.3 1.75018 8.78999 2.92018L3.77999 6.83018C2.77999 7.61018 1.98999 9.21018 1.98999 10.4702V17.3702C1.98999 19.9202 4.05999 22.0002 6.60999 22.0002H17.39C19.94 22.0002 22.01 19.9302 22.01 17.3802V10.6002C22.01 9.25018 21.14 7.59018 20.04 6.82018ZM12.75 18.0002C12.75 18.4102 12.41 18.7502 12 18.7502C11.59 18.7502 11.25 18.4102 11.25 18.0002V15.0002C11.25 14.5902 11.59 14.2502 12 14.2502C12.41 14.2502 12.75 14.5902 12.75 15.0002V18.0002Z" fill="#808797"/></svg>`,
        icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.04 6.82006L14.28 2.79006C12.71 1.69006 10.3 1.75006 8.78999 2.92006L3.77999 6.83006C2.77999 7.61006 1.98999 9.21006 1.98999 10.4701V17.3701C1.98999 19.9201 4.05999 22.0001 6.60999 22.0001H17.39C19.94 22.0001 22.01 19.9301 22.01 17.3801V10.6001C22.01 9.25006 21.14 7.59006 20.04 6.82006ZM12.75 18.0001C12.75 18.4101 12.41 18.7501 12 18.7501C11.59 18.7501 11.25 18.4101 11.25 18.0001V15.0001C11.25 14.5901 11.59 14.2501 12 14.2501C12.41 14.2501 12.75 14.5901 12.75 15.0001V18.0001Z" fill="#4A9300"/></svg>`,
        title: 'Trang chủ'
    },
    {
        page: Shop,
        iconActive: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22.36 8.27L22.07 5.5C21.65 2.48 20.28 1.25 17.35 1.25H14.99H13.51H10.47H8.98999H6.58999C3.64999 1.25 2.28999 2.48 1.85999 5.53L1.58999 8.28C1.48999 9.35 1.77999 10.39 2.40999 11.2C3.16999 12.19 4.33999 12.75 5.63999 12.75C6.89999 12.75 8.10999 12.12 8.86999 11.11C9.54999 12.12 10.71 12.75 12 12.75C13.29 12.75 14.42 12.15 15.11 11.15C15.88 12.14 17.07 12.75 18.31 12.75C19.64 12.75 20.84 12.16 21.59 11.12C22.19 10.32 22.46 9.31 22.36 8.27Z" fill="#808797"/><path d="M11.35 16.66C10.08 16.79 9.12 17.87 9.12 19.15V21.89C9.12 22.16 9.33999 22.38 9.60999 22.38H14.38C14.65 22.38 14.87 22.16 14.87 21.89V19.5C14.88 17.41 13.65 16.42 11.35 16.66Z" fill="#808797"/><path d="M21.37 14.4V17.38C21.37 20.14 19.13 22.38 16.37 22.38C16.1 22.38 15.88 22.16 15.88 21.89V19.5C15.88 18.22 15.49 17.22 14.73 16.54C14.06 15.93 13.15 15.63 12.02 15.63C11.77 15.63 11.52 15.64 11.25 15.67C9.47001 15.85 8.12 17.35 8.12 19.15V21.89C8.12 22.16 7.9 22.38 7.63 22.38C4.87 22.38 2.63 20.14 2.63 17.38V14.42C2.63 13.72 3.32 13.25 3.97 13.48C4.24 13.57 4.51 13.64 4.79 13.68C4.91 13.7 5.04 13.72 5.16 13.72C5.32 13.74 5.48 13.75 5.64 13.75C6.8 13.75 7.94 13.32 8.84 12.58C9.70001 13.32 10.82 13.75 12 13.75C13.19 13.75 14.29 13.34 15.15 12.6C16.05 13.33 17.17 13.75 18.31 13.75C18.49 13.75 18.67 13.74 18.84 13.72C18.96 13.71 19.07 13.7 19.18 13.68C19.49 13.64 19.77 13.55 20.05 13.46C20.7 13.24 21.37 13.72 21.37 14.4Z" fill="#808797"/></svg>`,
        icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22.36 8.27L22.07 5.5C21.65 2.48 20.28 1.25 17.35 1.25H14.99H13.51H10.47H8.99002H6.59002C3.65002 1.25 2.29002 2.48 1.86002 5.53L1.59002 8.28C1.49002 9.35 1.78002 10.39 2.41002 11.2C3.17002 12.19 4.34002 12.75 5.64002 12.75C6.90002 12.75 8.11002 12.12 8.87002 11.11C9.55002 12.12 10.71 12.75 12 12.75C13.29 12.75 14.42 12.15 15.11 11.15C15.88 12.14 17.07 12.75 18.31 12.75C19.64 12.75 20.84 12.16 21.59 11.12C22.19 10.32 22.46 9.31 22.36 8.27Z" fill="#4A9300"/><path d="M11.35 16.6602C10.08 16.7902 9.12 17.8702 9.12 19.1502V21.8902C9.12 22.1602 9.33999 22.3802 9.60999 22.3802H14.38C14.65 22.3802 14.87 22.1602 14.87 21.8902V19.5002C14.88 17.4102 13.65 16.4202 11.35 16.6602Z" fill="#4A9300"/><path d="M21.37 14.4001V17.3801C21.37 20.1401 19.13 22.3801 16.37 22.3801C16.1 22.3801 15.88 22.1601 15.88 21.8901V19.5001C15.88 18.2201 15.49 17.2201 14.73 16.5401C14.06 15.9301 13.15 15.6301 12.02 15.6301C11.77 15.6301 11.52 15.6401 11.25 15.6701C9.47001 15.8501 8.12 17.3501 8.12 19.1501V21.8901C8.12 22.1601 7.9 22.3801 7.63 22.3801C4.87 22.3801 2.63 20.1401 2.63 17.3801V14.4201C2.63 13.7201 3.32 13.2501 3.97 13.4801C4.24 13.5701 4.51 13.6401 4.79 13.6801C4.91 13.7001 5.04 13.7201 5.16 13.7201C5.32 13.7401 5.48 13.7501 5.64 13.7501C6.8 13.7501 7.94 13.3201 8.84 12.5801C9.70001 13.3201 10.82 13.7501 12 13.7501C13.19 13.7501 14.29 13.3401 15.15 12.6001C16.05 13.3301 17.17 13.7501 18.31 13.7501C18.49 13.7501 18.67 13.7401 18.84 13.7201C18.96 13.7101 19.07 13.7001 19.18 13.6801C19.49 13.6401 19.77 13.5501 20.05 13.4601C20.7 13.2401 21.37 13.7201 21.37 14.4001Z" fill="#4A9300"/></svg>`,
        title: 'Gian hàng'
    },
    {
        page: Community,
        iconActive: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.65 20.91C7.62 20.91 7.58 20.93 7.55 20.93C5.61 19.97 4.03 18.38 3.06 16.44C3.06 16.41 3.08 16.37 3.08 16.34C4.3 16.7 5.56 16.97 6.81 17.18C7.03 18.44 7.29 19.69 7.65 20.91Z" fill="#808797"/><path d="M20.94 16.45C19.95 18.44 18.3 20.05 16.29 21.02C16.67 19.75 16.99 18.47 17.2 17.18C18.46 16.97 19.7 16.7 20.92 16.34C20.91 16.38 20.94 16.42 20.94 16.45Z" fill="#808797"/><path d="M21.02 7.71C19.76 7.33 18.49 7.02 17.2 6.8C16.99 5.51 16.68 4.23 16.29 2.98C18.36 3.97 20.03 5.64 21.02 7.71Z" fill="#808797"/><path d="M7.65001 3.09C7.29001 4.31 7.03001 5.55 6.82001 6.81C5.53001 7.01 4.25001 7.33 2.98001 7.71C3.95001 5.7 5.56001 4.05 7.55001 3.06C7.58001 3.06 7.62001 3.09 7.65001 3.09Z" fill="#808797"/><path d="M15.49 6.59C13.17 6.33 10.83 6.33 8.51001 6.59C8.76001 5.22 9.08001 3.85 9.53001 2.53C9.55001 2.45 9.54001 2.39 9.55001 2.31C10.34 2.12 11.15 2 12 2C12.84 2 13.66 2.12 14.44 2.31C14.45 2.39 14.45 2.45 14.47 2.53C14.92 3.86 15.24 5.22 15.49 6.59Z" fill="#808797"/><path d="M6.59 15.49C5.21 15.24 3.85 14.92 2.53 14.47C2.45 14.45 2.39 14.46 2.31 14.45C2.12 13.66 2 12.85 2 12C2 11.16 2.12 10.34 2.31 9.55999C2.39 9.54999 2.45 9.54999 2.53 9.52999C3.86 9.08999 5.21 8.75999 6.59 8.50999C6.34 10.83 6.34 13.17 6.59 15.49Z" fill="#808797"/><path d="M22 12C22 12.85 21.88 13.66 21.69 14.45C21.61 14.46 21.55 14.45 21.47 14.47C20.14 14.91 18.78 15.24 17.41 15.49C17.67 13.17 17.67 10.83 17.41 8.50999C18.78 8.75999 20.15 9.07999 21.47 9.52999C21.55 9.54999 21.61 9.55999 21.69 9.55999C21.88 10.35 22 11.16 22 12Z" fill="#808797"/><path d="M15.49 17.41C15.24 18.79 14.92 20.15 14.47 21.47C14.45 21.55 14.45 21.61 14.44 21.69C13.66 21.88 12.84 22 12 22C11.15 22 10.34 21.88 9.55001 21.69C9.54001 21.61 9.55001 21.55 9.53001 21.47C9.09001 20.14 8.76001 18.79 8.51001 17.41C9.67001 17.54 10.83 17.63 12 17.63C13.17 17.63 14.34 17.54 15.49 17.41Z" fill="#808797"/><path d="M15.7633 15.7633C13.2622 16.0789 10.7378 16.0789 8.23667 15.7633C7.92111 13.2622 7.92111 10.7378 8.23667 8.23667C10.7378 7.92111 13.2622 7.92111 15.7633 8.23667C16.0789 10.7378 16.0789 13.2622 15.7633 15.7633Z" fill="#808797"/></svg>`,
        icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.65006 20.9098C7.62006 20.9098 7.58006 20.9298 7.55006 20.9298C5.61006 19.9698 4.03006 18.3798 3.06006 16.4398C3.06006 16.4098 3.08006 16.3698 3.08006 16.3398C4.30006 16.6998 5.56006 16.9698 6.81006 17.1798C7.03006 18.4398 7.29006 19.6898 7.65006 20.9098Z" fill="#4A9300"/><path d="M20.94 16.4498C19.95 18.4398 18.3 20.0498 16.29 21.0198C16.67 19.7498 16.99 18.4698 17.2 17.1798C18.46 16.9698 19.7 16.6998 20.92 16.3398C20.91 16.3798 20.94 16.4198 20.94 16.4498Z" fill="#4A9300"/><path d="M21.02 7.70998C19.76 7.32998 18.49 7.01998 17.2 6.79998C16.99 5.50998 16.68 4.22998 16.29 2.97998C18.36 3.96998 20.03 5.63998 21.02 7.70998Z" fill="#4A9300"/><path d="M7.64998 3.09006C7.28998 4.31006 7.02998 5.55006 6.81998 6.81006C5.52998 7.01006 4.24998 7.33006 2.97998 7.71006C3.94998 5.70006 5.55998 4.05006 7.54998 3.06006C7.57998 3.06006 7.61998 3.09006 7.64998 3.09006Z" fill="#4A9300"/><path d="M15.49 6.59C13.17 6.33 10.83 6.33 8.51001 6.59C8.76001 5.22 9.08001 3.85 9.53001 2.53C9.55001 2.45 9.54001 2.39 9.55001 2.31C10.34 2.12 11.15 2 12 2C12.84 2 13.66 2.12 14.44 2.31C14.45 2.39 14.45 2.45 14.47 2.53C14.92 3.86 15.24 5.22 15.49 6.59Z" fill="#4A9300"/><path d="M6.59 15.4898C5.21 15.2398 3.85 14.9198 2.53 14.4698C2.45 14.4498 2.39 14.4598 2.31 14.4498C2.12 13.6598 2 12.8498 2 11.9998C2 11.1598 2.12 10.3398 2.31 9.55977C2.39 9.54977 2.45 9.54977 2.53 9.52977C3.86 9.08977 5.21 8.75977 6.59 8.50977C6.34 10.8298 6.34 13.1698 6.59 15.4898Z" fill="#4A9300"/><path d="M22 11.9998C22 12.8498 21.88 13.6598 21.69 14.4498C21.61 14.4598 21.55 14.4498 21.47 14.4698C20.14 14.9098 18.78 15.2398 17.41 15.4898C17.67 13.1698 17.67 10.8298 17.41 8.50977C18.78 8.75977 20.15 9.07977 21.47 9.52977C21.55 9.54977 21.61 9.55977 21.69 9.55977C21.88 10.3498 22 11.1598 22 11.9998Z" fill="#4A9300"/><path d="M15.49 17.4102C15.24 18.7902 14.92 20.1502 14.47 21.4702C14.45 21.5502 14.45 21.6102 14.44 21.6902C13.66 21.8802 12.84 22.0002 12 22.0002C11.15 22.0002 10.34 21.8802 9.55001 21.6902C9.54001 21.6102 9.55001 21.5502 9.53001 21.4702C9.09001 20.1402 8.76001 18.7902 8.51001 17.4102C9.67001 17.5402 10.83 17.6302 12 17.6302C13.17 17.6302 14.34 17.5402 15.49 17.4102Z" fill="#4A9300"/><path d="M15.7633 15.7633C13.2622 16.0789 10.7378 16.0789 8.23667 15.7633C7.92111 13.2622 7.92111 10.7378 8.23667 8.23667C10.7378 7.92111 13.2622 7.92111 15.7633 8.23667C16.0789 10.7378 16.0789 13.2622 15.7633 15.7633Z" fill="#4A9300"/></svg>`,
        title: 'Cộng đồng'
    },
    {
        page: User,
        iconActive: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12C14.7614 12 17 9.76142 17 7C17 4.23858 14.7614 2 12 2C9.23858 2 7 4.23858 7 7C7 9.76142 9.23858 12 12 12Z" fill="#808797"/><path d="M12 14.5C6.99 14.5 2.91 17.86 2.91 22C2.91 22.28 3.13 22.5 3.41 22.5H20.59C20.87 22.5 21.09 22.28 21.09 22C21.09 17.86 17.01 14.5 12 14.5Z" fill="#808797"/></svg>`,
        icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12C14.7614 12 17 9.76142 17 7C17 4.23858 14.7614 2 12 2C9.23858 2 7 4.23858 7 7C7 9.76142 9.23858 12 12 12Z" fill="#4A9300"/><path d="M12 14.5C6.99003 14.5 2.91003 17.86 2.91003 22C2.91003 22.28 3.13003 22.5 3.41003 22.5H20.59C20.87 22.5 21.09 22.28 21.09 22C21.09 17.86 17.01 14.5 12 14.5Z" fill="#4A9300"/></svg>`,
        title: 'Cá nhân'
    },
]

class RenderLabel extends Component<{ focused: boolean, title: string }, {}> {
    render(): React.ReactNode {
        return (
            //FIXME: CUSTOM THIS APP: only show label when focused
            <LABELTEXTCLASS style={{ color: this.props.focused ? COLORFOCUS : COLORNOTFOCUS }}>{this.props.title}</LABELTEXTCLASS>
        );
    }
}

// // ____________________END OF IMPORT_______________________

const BottomTab = () => {
    const navigation = useNavigation();
    const insets = useSafeAreaInsets();
    const Tab = createBottomTabNavigator();
    const [CurrentCache, dispatch] = React.useContext(CUSTOMCACHE.RootContext);

    // useEffect(() => {
    //     const fetchUser = async () => {
    //         let user: UserFormat | false = await STORAGEFNC.getUser();
    //         if (user && user.name) {
    //             dispatch(CUSTOMCACHE.currentSetUser(user));
    //             if (!user.dataCollect) {
    //                 navigation.navigate('DataCollect' as never);
    //             }
    //         } else {
    //             navigation.reset({
    //                 index: 0,
    //                 routes: [{ name: 'LoginOpt' as never }],
    //             });
    //         }
    //     };
    //     fetchUser();
    // }, []);

    return (
        <Tab.Navigator
            tabBar={props => <BottomTabBar {...props} />}
            screenOptions={{
                headerShown: false,
                tabBarShowLabel: true,
                tabBarHideOnKeyboard: true,
                tabBarStyle: {
                    height: BOTTOM_TAB_HEIGHT + insets.bottom + vw(2),
                    paddingHorizontal: vw(6),
                    paddingBottom: insets.bottom + vh(0.5),
                    paddingTop: vw(1.75)
                },
            }}
        >
            {iconData.map((item, index) => (
                <Tab.Screen
                    key={index}
                    name={item.title}
                    component={item.page}
                    options={{
                        tabBarIcon: ({ focused }) => (
                            <SvgXml xml={focused ? item.icon : item.iconActive} width={BOTTOM_TAB_ICON_SIZE} height={BOTTOM_TAB_ICON_SIZE} />
                        ),
                        tabBarLabel: ({ focused }) => (
                            <RenderLabel focused={focused} title={item.title} />
                        ),
                    }}
                />
            ))}
        </Tab.Navigator>
    );
};

export default BottomTab;